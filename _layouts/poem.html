{% if page.background_image %}
<!-- If you want to include background image container, add your code here -->
{% endif %}

<span class="poem-genre">{{ page.genre | capitalize }}</span>
<time class="poem-date">{{ page.date | date: "%B %d, %Y" }}</time>
<h1 class="poem-title">{{ page.title }}</h1>
<p class="poem-excerpt">{{ page.excerpt }}</p>
<span class="reading-time">{{ page.content | number_of_words | divided_by: 200 | plus: 1 }} min read</span>

<div class="poem-tags">
  {% for tag in page.tags %}
    <span class="tag">{{ tag }}</span>
  {% endfor %}
</div>

<div class="poem-text">
  {{ content }}
</div>

<div class="poem-actions">
  <button class="btn-share" onclick="sharePoem()">Share Poem</button>
  <button class="btn-print" onclick="printPoem()">Print</button>
</div>

{% assign poems = site.poems | sort: 'date' | reverse %}
{% for poem in poems %}
  {% if poem.url == page.url %}
    {% unless forloop.first %}
      {% assign prev_poem = poems[forloop.index0 | minus: 1] %}
    {% endunless %}
    {% unless forloop.last %}
      {% assign next_poem = poems[forloop.index0 | plus: 1] %}
    {% endunless %}
    {% break %}
  {% endif %}
{% endfor %}

<div class="nav-links">
  {% if prev_poem %}
    <a href="{{ prev_poem.url | relative_url }}" class="nav-link prev-link">
      <span class="nav-label">Previous</span>
      <span class="nav-title">{{ prev_poem.title }}</span>
    </a>
  {% endif %}
  {% if next_poem %}
    <a href="{{ next_poem.url | relative_url }}" class="nav-link next-link">
      <span class="nav-label">Next</span>
      <span class="nav-title">{{ next_poem.title }}</span>
    </a>
  {% endif %}
</div>

<div class="related-poems">
  <h3>Related Poems</h3>
  <div class="related-grid">
    {% assign related_poems = site.poems | where: "genre", page.genre | limit: 3 %}
    {% for poem in related_poems %}
      {% unless poem.url == page.url %}
        <article class="poem-card">
          <h4><a href="{{ poem.url | relative_url }}">{{ poem.title }}</a></h4>
          <p>{{ poem.excerpt }}</p>
          <div class="poem-meta">
            <span class="genre">{{ poem.genre | capitalize }}</span>
            <time>{{ poem.date | date: "%b %d" }}</time>
          </div>
        </article>
      {% endunless %}
    {% endfor %}
  </div>
</div>

{% if site.disqus.shortname %}
<section class="comments">
  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = "{{ page.url | absolute_url }}";
      this.page.identifier = "{{ page.url }}";
    };
    (function() {
      var d = document, s = d.createElement('script');
      s.src = 'https://{{ site.disqus.shortname }}.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>
{% endif %}

<script>
function sharePoem() {
  if (navigator.share) {
    navigator.share({
      title: '{{ page.title | escape }}',
      text: '{{ page.excerpt | escape }}',
      url: window.location.href
    }).catch(error => {
      console.log('Error sharing:', error);
      fallbackCopyToClipboard();
    });
  } else {
    fallbackCopyToClipboard();
  }
}

function fallbackCopyToClipboard() {
  if (navigator.clipboard && navigator.clipboard.writeText) {
    navigator.clipboard.writeText(window.location.href).then(() => {
      alert('Link copied to clipboard!');
    }).catch(err => {
      legacyCopyToClipboard();
    });
  } else {
    legacyCopyToClipboard();
  }
}

function legacyCopyToClipboard() {
  var textArea = document.createElement('textarea');
  textArea.value = window.location.href;
  document.body.appendChild(textArea);
  textArea.select();
  try {
    document.execCommand('copy');
    alert('Link copied to clipboard!');
  } catch (err) {
    alert('Unable to copy link. Please copy manually: ' + window.location.href);
  }
  document.body.removeChild(textArea);
}

function printPoem() {
  window.print();
}
</script>
